---
title: DurableAgent
---

import { ExperimentalPackageCallout } from "@/components/experimental-package-callout"

# `DurableAgent`

<ExperimentalPackageCallout packageName="@workflow/ai" />

A class for building durable AI agents within workflows. `DurableAgent` enables you to create AI-powered agents that can maintain state across workflow steps, call tools, and gracefully handle interruptions and resumptions.

<Callout>
`DurableAgent` is part of the `@workflow/ai` package. Tools can be implemented as workflow steps for automatic retries, or as regular workflow-level logic using core library features like `sleep()` and Hooks.
</Callout>

```typescript lineNumbers
import { DurableAgent } from '@workflow/ai/agent';
import { z } from 'zod';

const agent = new DurableAgent({
  model: 'anthropic/claude-4-opus-20250514',
  tools: {
    getWeather: {
      description: 'Get weather for a city',
      inputSchema: z.object({ city: z.string() }),
      execute: async ({ city }) => {
        'use step';
        return `Weather in ${city} is sunny`;
      },
    },
  },
  system: 'You are a helpful weather assistant.',
});

await agent.stream({
  messages: [{ role: 'user', content: 'What is the weather?' }],
});
```

## API Signature

### Constructor

Creates a new `DurableAgent` instance with the specified configuration.

```typescript
constructor(options: DurableAgentOptions)
```

#### DurableAgentOptions

```typescript
interface DurableAgentOptions {
  /**
   * The model identifier to use for the agent.
   * This should be a string compatible with the AI SDK (e.g., 'anthropic/claude-4-opus').
   */
  model: string;

  /**
   * A set of tools available to the agent.
   * Tools can include workflow steps for durable execution.
   */
  tools: ToolSet;

  /**
   * Optional system prompt to guide the agent's behavior.
   */
  system?: string;
}
```

### Methods

#### `stream()`

Streams the agent's execution, processing tool calls and managing the AI conversation flow.

```typescript
async stream(options: DurableAgentStreamOptions): Promise<void>
```

##### DurableAgentStreamOptions

```typescript
interface DurableAgentStreamOptions {
  /**
   * The conversation messages to process.
   * Should follow the AI SDK's ModelMessage format.
   */
  messages: ModelMessage[];

  /**
   * Optional system prompt override.
   * If provided, overrides the system prompt from the constructor.
   */
  system?: string;

  /**
   * Optional custom writable stream for handling message chunks.
   * If not provided, a default writable stream will be created using getWritable().
   */
  writable?: WritableStream<UIMessageChunk>;
}
```

## Key Features

- **Durable Execution**: Agents can be interrupted and resumed without losing state
- **Flexible Tool Implementation**: Tools can be implemented as workflow steps for automatic retries, or as regular workflow-level logic
- **Stream Processing**: Handles streaming responses and tool calls in a structured way
- **Workflow Native**: Fully integrated with the Workflow framework for production-grade reliability

## Good to Know

- Tools can be implemented as workflow steps (using `'use step'` for automatic retries), or as regular workflow-level logic
- Tools can use core library features like `sleep()` and Hooks within their `execute` functions
- The agent processes tool calls iteratively until completion
- Messages must be serializable for workflow persistence
- The `system` prompt in `stream()` options overrides the constructor's system prompt
- When no custom `writable` stream is provided, the agent uses the workflow's default writable stream

## Examples

### Basic Agent with Tools

```typescript
import { DurableAgent } from '@workflow/ai/agent';
import { z } from 'zod';

async function getWeather({ location }: { location: string }) {
  'use step';
  // Fetch weather data
  const response = await fetch(`https://api.weather.com?location=${location}`);
  return response.json();
}

async function weatherAgentWorkflow(userQuery: string) {
  'use workflow';

  const agent = new DurableAgent({
    model: 'anthropic/claude-opus',
    tools: {
      getWeather: {
        description: 'Get current weather for a location',
        inputSchema: z.object({ location: z.string() }),
        execute: getWeather,
      },
    },
    system: 'You are a helpful weather assistant. Always provide accurate weather information.',
  });

  await agent.stream({
    messages: [
      {
        role: 'user',
        content: userQuery,
      },
    ],
  });
}
```

### Multiple Tools

```typescript
import { DurableAgent } from '@workflow/ai/agent';
import { z } from 'zod';

async function getWeather({ location }: { location: string }) {
  'use step';
  return `Weather in ${location}: Sunny, 72Â°F`;
}

async function searchEvents({ location, category }: { location: string; category: string }) {
  'use step';
  return `Found 5 ${category} events in ${location}`;
}

async function multiToolAgentWorkflow(userQuery: string) {
  'use workflow';

  const agent = new DurableAgent({
    model: 'gpt-4',
    tools: {
      getWeather: {
        description: 'Get weather for a location',
        inputSchema: z.object({ location: z.string() }),
        execute: getWeather,
      },
      searchEvents: {
        description: 'Search for upcoming events in a location',
        inputSchema: z.object({ location: z.string(), category: z.string() }),
        execute: searchEvents,
      },
    },
  });

  await agent.stream({
    messages: [
      {
        role: 'user',
        content: userQuery,
      },
    ],
  });
}
```

### With System Prompt Override

```typescript
import { DurableAgent } from '@workflow/ai/agent';

async function customSystemPromptWorkflow() {
  'use workflow';

  const agent = new DurableAgent({
    model: 'anthropic/claude-opus',
    tools: {
      // ... tools configuration
    },
    system: 'Default system prompt',
  });

  await agent.stream({
    messages: [{ role: 'user', content: 'Hello!' }],
    system: 'Override system prompt for this specific call',
  });
}
```

### Tools with Workflow Library Features

```typescript
import { DurableAgent } from '@workflow/ai/agent';
import { sleep, defineHook } from 'workflow';
import { z } from 'zod';

const approvalHook = defineHook({
  id: 'approval',
  handler: async (input: { message: string }) => input,
});

async function scheduleTask({ taskName, delaySeconds }: { taskName: string; delaySeconds: number }) {
  'use step';
  // Use core library features like sleep() in tools
  await sleep(`${delaySeconds}s`);
  return `Task "${taskName}" has been executed`;
}

async function requestApproval({ message }: { message: string }) {
  'use step';
  // Use Hooks within tool execution
  const approval = await approvalHook.trigger({ message });
  return `Approval received: ${approval.message}`;
}

async function agentWithLibraryFeaturesWorkflow(userRequest: string) {
  'use workflow';

  const agent = new DurableAgent({
    model: 'gpt-4',
    tools: {
      scheduleTask: {
        description: 'Schedule a task to run after a delay',
        inputSchema: z.object({
          taskName: z.string(),
          delaySeconds: z.number(),
        }),
        execute: scheduleTask,
      },
      requestApproval: {
        description: 'Request approval for an action',
        inputSchema: z.object({ message: z.string() }),
        execute: requestApproval,
      },
    },
  });

  await agent.stream({
    messages: [{ role: 'user', content: userRequest }],
  });
}
```

## See Also

- [WorkflowChatTransport](/docs/api-reference/workflow-ai/workflow-chat-transport) - Transport layer for AI SDK streams
- [Workflows and Steps](/docs/foundations/workflows-and-steps) - Understanding workflow fundamentals
- [AI SDK Documentation](https://sdk.vercel.ai) - External AI SDK reference
